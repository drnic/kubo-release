---
<%
nats_ips = nil
if_p('nats.machines') do |ips|
  nats_ips = ips.compact
end.else do
  nats_ips = link('nats').instances.map { |instance| instance.address }
end

nats_port = nil
if_p('nats.port') do |prop|
  nats_port = prop
end.else do
  nats_port = link('nats').p("nats.port")
end
nats_user = nil
if_p('nats.user') do |prop|
  nats_user = prop
end.else do
  nats_user = link('nats').p("nats.user")
end
nats_password = nil
if_p('nats.password') do |prop|
  nats_password = prop
end.else do
  nats_password = link('nats').p("nats.password")
end

%>

nats_servers:
<% nats_ips.each do |ip| %>
   - host: <%="#{ip}:#{nats_port}" %>
     user: <%=nats_user %>
     password: <%=nats_password %>
<% end %>
<%
cf_credentials = api_url = uaa_url = username = password = routing_api_client_secret = nil
if_link("cf-credentials") do |cf|
  cf_credentials = cf
  api_url = cf.p("api_url")
  uaa_url = cf.p("uaa_url")
  routing_api_client_secret = cf.p("uaa_clients")["routing_api_client"]["secret"]
end
%>
app_domain_name: <%= p("cloud_foundry.app_domain") %>
uaa_api_url: <%= p("cloud_foundry.uaa_url", uaa_url) %>
routing_api_url: <%= p("cloud_foundry.routing_api_url", api_url) %>
routing_api_username: <%= p("cloud_foundry.routing_api_client_id", "routing_api_client") %>
routing_api_client_secret: <%= p("cloud_foundry.routing_api_client_secret", routing_api_client_secret) %>
skip_tls_verification: <%= p("cloud_foundry.skip_tls_verification", !!cf_credentials) %>
kube_config_path: /var/vcap/jobs/route-sync/config/kubeconfig
